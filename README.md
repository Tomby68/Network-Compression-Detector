# Detection of packet compression over a network: End-to-end and standalone

Intermediary compression detection on a network. Done in two ways: 
Part 1 is end-to-end, with client and server applications that cooperate
to detect whether or not packets are being compressed between them.
Part 2 is standalone, with only a host application sending and capturing packets
to deduce whether or not there is compression on the network. 
This program is based on the findings of this paper: [Compression Detection](https://www.cs.usfca.edu/vahab/resources/compression_detection.pdf)


## Table of Contents


- ### Requirements


- ### Installation and Configuration


- ### Part 1: End-to-end application to detect packet compression


- ### Part 2: Standalone application to detect packet compression


## Requirements

Must be run on a linux distribution. Requires installation of make and gcc, which can be done with:
```
sudo apt install make
sudo apt install gcc
```
Part 1 requires two machines, one running the client application and the other running the server
application at the same time. Part 2 can be run on just one machine.

## Installation and Configuration

Clone or download the repo, then navigate to either comp-detection/part1 for the end-to-end 
implementation, or comp-detection/part2 for the standalone implementation. Once there, fill in the 
config.json file, or import your own file with your desired parameters (ex. server_ip). Then, call 
make to build the program.
For part 1: 
Run the server application first, then run the client application.
On the server machine:
```
./compdetect_server [server_port]
```
On the client machine:
```
./compdetect_client [config file]
```
For part 2:
Run the standalone application:
```
sudo ./compdetect [config file]
```

## Part 1: End-to-end
This program detects whether or not packets are being compressed on a network between two hosts.
The client parses the config file and sends its contents to the server over a TCP connection. 
Then, the client sends two UDP packet trains: one with low entropy data and one with high entropy data. 
For both trains, the server saves the timestamps of the first and last received packet and calculates the difference between
them. Finally, the server calculates the difference between the two timestamp differences, and sends the final value back
to the client over another TCP connection. The client can then decide whether or not compression occurred. If the final 
difference is greater than 100 milliseconds, compression has occurred.

## Part 2: Standalone
This program detects whether or not packets are being compressed on a network between two hosts
by sending two packet trains, one with low entropy data and one with high entropy data. By bookending each of
these packet trains with a TCP SYN head and TCP SYN tail packet over a raw socket, we can 
capture the TCP RST packets generated by the server and save their timestamps. We then have the difference
between the head and tail packets from the low entropy and high entropy packet trains. The last step
is to compare the differences between these two times, and see if it is greater than the threshold outlined 
in the paper. If so, then compression occurs on the network. Otherwise, compression does not occur on the network.
